{% extends 'base.html' %}
{% load static %}

{% block title %}–í—ã–±–æ—Ä –Ω–æ–≤–æ–π —Ä–æ–ª–∏ - –°–ø–æ—Ä—Ç–ë–∞—à{% endblock %}

{% block content %}
<div class="container" style="max-width: 800px;">
    <div style="margin-bottom: 1rem;">
        <a href="{% url 'frontend-dashboard' %}" style="color: var(--primary-blue); text-decoration: none;">
            ‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç
        </a>
    </div>
    
    <h1>–í—ã–±–æ—Ä –Ω–æ–≤–æ–π —Ä–æ–ª–∏</h1>
    
    <div class="card">
        <div class="card-header">
            <h2 class="card-title">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–ª—å –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è</h2>
        </div>
        <div class="card-body">
            <p style="margin-bottom: 1.5rem; color: var(--text-light);">
                –í—ã –º–æ–∂–µ—Ç–µ –∏–º–µ—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–æ–ª–µ–π –≤ —Å–∏—Å—Ç–µ–º–µ. –í—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–ª—å, –∫–æ—Ç–æ—Ä—É—é —Ö–æ—Ç–∏—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –∫ —Å–≤–æ–µ–º—É –∞–∫–∫–∞—É–Ω—Ç—É.
            </p>
            
            <div id="messages"></div>
            
            <p style="margin-bottom: 1rem; color: var(--text-light); font-size: 0.9rem;">
                <strong>–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:</strong> –†–æ–ª—å "–†–æ–¥–∏—Ç–µ–ª—å" –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—è–≤–∏—Ç—Å—è –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ä–µ–±—ë–Ω–∫–∞. 
                –†–æ–ª—å "–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è" –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ—Å–ª–µ –ø–æ–¥–∞—á–∏ –∑–∞—è–≤–∫–∏ –∏ –µ—ë –æ–¥–æ–±—Ä–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º.
            </p>
            
            <div class="grid grid-2" style="gap: 1rem;">
                <div class="role-card" data-role="athlete" onclick="showRoleForm('athlete')">
                    <div class="role-icon">üèÉ</div>
                    <h3>–°–ø–æ—Ä—Ç—Å–º–µ–Ω</h3>
                    <p>–£—á–∞—Å—Ç–∏–µ –≤ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è—Ö, –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞</p>
                </div>
                
                <div class="role-card" data-role="coach" onclick="showRoleForm('coach')">
                    <div class="role-icon">üèãÔ∏è</div>
                    <h3>–¢—Ä–µ–Ω–µ—Ä</h3>
                    <p>–ü—Ä–æ–≤–µ–¥–µ–Ω–∏–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥—Ä—É–ø–ø–∞–º–∏</p>
                </div>
                
                <div class="role-card" data-role="organization" onclick="showOrganizationRequestForm()" style="cursor: pointer;">
                    <div class="role-icon">üè¢</div>
                    <h3>–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è</h3>
                    <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–µ–π, —Å–æ–∑–¥–∞–Ω–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π</p>
                    <small style="color: var(--text-light); display: block; margin-top: 0.5rem;">–¢—Ä–µ–±—É–µ—Ç—Å—è –æ–¥–æ–±—Ä–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</small>
                </div>
                
                <div class="role-card" data-role="committee_staff" onclick="window.location.href='{% url 'frontend-committee-register' %}'" style="cursor: pointer;">
                    <div class="role-icon">üèõÔ∏è</div>
                    <h3>–°–æ—Ç—Ä—É–¥–Ω–∏–∫ —Å–ø–æ—Ä—Ç–∫–æ–º–∏—Ç–µ—Ç–∞</h3>
                    <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è–º–∏, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π</p>
                    <small style="color: var(--text-light); display: block; margin-top: 0.5rem;">–¢—Ä–µ–±—É–µ—Ç—Å—è –∫–æ–¥ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</small>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Ñ–æ—Ä–º—ã —Å–ø–æ—Ä—Ç—Å–º–µ–Ω–∞ -->
<div id="athleteModal" class="role-modal" style="display: none;">
    <div class="role-modal-content">
        <div class="role-modal-header">
            <h3>–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ä–æ–ª–∏: –°–ø–æ—Ä—Ç—Å–º–µ–Ω</h3>
            <span class="role-modal-close" onclick="closeRoleModal('athleteModal')">&times;</span>
        </div>
        <div class="role-modal-body">
            <form id="athleteForm">
                <div class="form-group">
                    <label for="athlete_city">–ì–æ—Ä–æ–¥ *</label>
                    <input type="text" id="athlete_city" name="city" class="form-control" required 
                           placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –£—Ñ–∞" value="{{ user.city|default:'' }}">
                </div>
                <div class="form-group">
                    <label for="athlete_sport">–í–∏–¥ —Å–ø–æ—Ä—Ç–∞ *</label>
                    <select id="athlete_sport" name="sport_id" class="form-control" required>
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≤–∏–¥ —Å–ø–æ—Ä—Ç–∞</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="athlete_birth_date">–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</label>
                    <input type="date" id="athlete_birth_date" name="birth_date" class="form-control">
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeRoleModal('athleteModal')">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn btn-primary">–î–æ–±–∞–≤–∏—Ç—å —Ä–æ–ª—å</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Ñ–æ—Ä–º—ã —Ç—Ä–µ–Ω–µ—Ä–∞ -->
<div id="coachModal" class="role-modal" style="display: none;">
    <div class="role-modal-content">
        <div class="role-modal-header">
            <h3>–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ä–æ–ª–∏: –¢—Ä–µ–Ω–µ—Ä</h3>
            <span class="role-modal-close" onclick="closeRoleModal('coachModal')">&times;</span>
        </div>
        <div class="role-modal-body">
            <form id="coachForm">
                <div class="form-group">
                    <label for="coach_city">–ì–æ—Ä–æ–¥ *</label>
                    <input type="text" id="coach_city" name="city_coach" class="form-control" required 
                           placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –£—Ñ–∞" value="{{ user.city|default:'' }}">
                </div>
                <div class="form-group">
                    <label for="coach_specialization">–°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è (–≤–∏–¥ —Å–ø–æ—Ä—Ç–∞) *</label>
                    <select id="coach_specialization" name="specialization_id" class="form-control" required>
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="coach_experience">–û–ø—ã—Ç —Ä–∞–±–æ—Ç—ã (–ª–µ—Ç) *</label>
                    <input type="number" id="coach_experience" name="experience_years" class="form-control" 
                           min="0" required placeholder="0">
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeRoleModal('coachModal')">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn btn-primary">–î–æ–±–∞–≤–∏—Ç—å —Ä–æ–ª—å</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –∑–∞—è–≤–∫–∏ –Ω–∞ —Ä–æ–ª—å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ -->
<div id="organizationModal" class="role-modal" style="display: none;">
    <div class="role-modal-content">
        <div class="role-modal-header">
            <h3>–ó–∞—è–≤–∫–∞ –Ω–∞ —Ä–æ–ª—å: –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è</h3>
            <span class="role-modal-close" onclick="closeRoleModal('organizationModal')">&times;</span>
        </div>
        <div class="role-modal-body">
            <p style="margin-bottom: 1rem; color: var(--text-light);">
                –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–æ–ª–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É. –ü–æ—Å–ª–µ –æ–¥–æ–±—Ä–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º –≤—ã —Å–º–æ–∂–µ—Ç–µ —Å–æ–∑–¥–∞—Ç—å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é.
            </p>
            <form id="organizationForm">
                <div class="form-group">
                    <label for="org_message">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                    <textarea id="org_message" name="message" class="form-control" rows="4" 
                              placeholder="–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –æ –≤–∞—à–µ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏, —Ü–µ–ª—è—Ö –∏ —Ç.–¥."></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeRoleModal('organizationModal')">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn btn-primary">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É</button>
                </div>
            </form>
        </div>
    </div>
</div>

<style>
.role-card {
    padding: 1.5rem;
    border: 2px solid var(--border-color);
    border-radius: var(--border-radius);
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    background: var(--bg-white);
}

.role-card:hover {
    border-color: var(--primary-blue);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.role-card.selected {
    border-color: var(--primary-blue);
    background: var(--secondary-blue);
}

.role-icon {
    font-size: 3rem;
    margin-bottom: 0.5rem;
}

.role-card h3 {
    margin: 0.5rem 0;
    color: var(--text-dark);
}

.role-card p {
    margin: 0;
    color: var(--text-light);
    font-size: 0.9rem;
}

.role-modal {
    display: none;
    position: fixed;
    z-index: 3000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0, 0, 0, 0.5);
    align-items: center;
    justify-content: center;
}

.role-modal-content {
    background-color: var(--white);
    margin: auto;
    padding: 0;
    border-radius: 12px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    max-width: 500px;
    width: 90%;
    animation: modalSlideIn 0.3s ease;
}

.role-modal-header {
    background: linear-gradient(135deg, var(--primary-blue) 0%, var(--primary-blue-dark) 100%);
    color: var(--white);
    padding: 1.25rem 1.5rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-radius: 12px 12px 0 0;
}

.role-modal-header h3 {
    margin: 0;
    color: var(--white);
    font-size: 1.25rem;
}

.role-modal-close {
    background: none;
    border: none;
    color: var(--white);
    font-size: 2rem;
    cursor: pointer;
    line-height: 1;
    padding: 0;
    width: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: background 0.2s;
}

.role-modal-close:hover {
    background: rgba(255, 255, 255, 0.2);
}

.role-modal-body {
    padding: 2rem;
}

.form-group {
    margin-bottom: 1.5rem;
}

.form-group label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 500;
    color: var(--text-dark);
}

.form-control {
    width: 100%;
    padding: 0.75rem;
    border: 2px solid var(--border-color);
    border-radius: 8px;
    font-size: 1rem;
    transition: border-color 0.3s;
}

.form-control:focus {
    outline: none;
    border-color: var(--primary-blue);
}

.form-actions {
    display: flex;
    gap: 1rem;
    justify-content: flex-end;
    margin-top: 2rem;
}

@keyframes modalSlideIn {
    from {
        transform: translateY(-50px);
        opacity: 0;
    }
    to {
        transform: translateY(0);
        opacity: 1;
    }
}
</style>

<script>
let sports = [];

// –ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–æ–≤ —Å–ø–æ—Ä—Ç–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', function() {
    loadSports();
});

function loadSports() {
    fetch('/api/sports/')
        .then(response => response.json())
        .then(data => {
            sports = data;
            const athleteSelect = document.getElementById('athlete_sport');
            const coachSelect = document.getElementById('coach_specialization');
            
            data.forEach(sport => {
                // –î–ª—è —Å–ø–æ—Ä—Ç—Å–º–µ–Ω–∞
                const option1 = document.createElement('option');
                option1.value = sport.id;
                option1.textContent = sport.name;
                athleteSelect.appendChild(option1);
                
                // –î–ª—è —Ç—Ä–µ–Ω–µ—Ä–∞
                const option2 = document.createElement('option');
                option2.value = sport.id;
                option2.textContent = sport.name;
                coachSelect.appendChild(option2);
            });
        })
        .catch(error => {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–æ–≤ —Å–ø–æ—Ä—Ç–∞:', error);
        });
}

function showRoleForm(role) {
    if (role === 'athlete') {
        document.getElementById('athleteModal').style.display = 'flex';
    } else if (role === 'coach') {
        document.getElementById('coachModal').style.display = 'flex';
    }
}

function showOrganizationRequestForm() {
    document.getElementById('organizationModal').style.display = 'flex';
}

function closeRoleModal(modalId) {
    document.getElementById(modalId).style.display = 'none';
}

// –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
window.onclick = function(event) {
    if (event.target.classList.contains('role-modal')) {
        event.target.style.display = 'none';
    }
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã —Å–ø–æ—Ä—Ç—Å–º–µ–Ω–∞
document.getElementById('athleteForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const sportIdValue = document.getElementById('athlete_sport').value;
    if (!sportIdValue) {
        document.getElementById('messages').innerHTML = 
            '<div class="alert alert-error">–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–±—Ä–∞—Ç—å –≤–∏–¥ —Å–ø–æ—Ä—Ç–∞</div>';
        return;
    }
    
    const formData = {
        role: 'athlete',
        city: document.getElementById('athlete_city').value.trim(),
        sport_id: parseInt(sportIdValue),
        birth_date: document.getElementById('athlete_birth_date').value || null
    };
    
    if (!formData.city) {
        document.getElementById('messages').innerHTML = 
            '<div class="alert alert-error">–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —É–∫–∞–∑–∞—Ç—å –≥–æ—Ä–æ–¥</div>';
        return;
    }
    
    submitRoleRequest(formData, 'athleteModal');
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã —Ç—Ä–µ–Ω–µ—Ä–∞
document.getElementById('coachForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const specializationIdValue = document.getElementById('coach_specialization').value;
    if (!specializationIdValue) {
        document.getElementById('messages').innerHTML = 
            '<div class="alert alert-error">–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–±—Ä–∞—Ç—å —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é</div>';
        return;
    }
    
    const experienceValue = document.getElementById('coach_experience').value;
    if (!experienceValue || parseInt(experienceValue) < 0) {
        document.getElementById('messages').innerHTML = 
            '<div class="alert alert-error">–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —É–∫–∞–∑–∞—Ç—å –æ–ø—ã—Ç —Ä–∞–±–æ—Ç—ã (0 –∏–ª–∏ –±–æ–ª—å—à–µ –ª–µ—Ç)</div>';
        return;
    }
    
    const formData = {
        role: 'coach',
        city_coach: document.getElementById('coach_city').value.trim(),
        specialization_id: parseInt(specializationIdValue),
        experience_years: parseInt(experienceValue)
    };
    
    if (!formData.city_coach) {
        document.getElementById('messages').innerHTML = 
            '<div class="alert alert-error">–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —É–∫–∞–∑–∞—Ç—å –≥–æ—Ä–æ–¥</div>';
        return;
    }
    
    submitRoleRequest(formData, 'coachModal');
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
document.getElementById('organizationForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const formData = {
        message: document.getElementById('org_message').value
    };
    
    fetch('/api/organizations/role-request/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCookie('csrftoken')
        },
        body: JSON.stringify(formData)
    })
    .then(response => response.json().then(data => ({ status: response.status, data })))
    .then(result => {
        if (result.status === 201) {
            document.getElementById('messages').innerHTML = 
                '<div class="alert alert-success">–ó–∞—è–≤–∫–∞ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞. –û–∂–∏–¥–∞–π—Ç–µ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º.</div>';
            closeRoleModal('organizationModal');
        } else {
            const errorMsg = result.data.error || result.data.message || '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞';
            document.getElementById('messages').innerHTML = 
                `<div class="alert alert-error">${errorMsg}</div>`;
        }
    })
    .catch(error => {
        console.error('–û—à–∏–±–∫–∞:', error);
        document.getElementById('messages').innerHTML = 
            '<div class="alert alert-error">–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–∞—è–≤–∫–∏</div>';
    });
});

function submitRoleRequest(formData, modalId) {
    const messagesDiv = document.getElementById('messages');
    messagesDiv.innerHTML = '<div class="alert alert-info">–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞...</div>';
    
    fetch('/api/users/select-role/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCookie('csrftoken')
        },
        body: JSON.stringify(formData)
    })
    .then(response => {
        return response.json().then(data => ({ status: response.status, data })).catch(() => {
            return { status: response.status, data: { error: '–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –æ—Ç–≤–µ—Ç–∞' } };
        });
    })
    .then(result => {
        if (result.status === 201) {
            messagesDiv.innerHTML = '<div class="alert alert-success">–†–æ–ª—å —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞!</div>';
            closeRoleModal(modalId);
            // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç —á–µ—Ä–µ–∑ –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É
            setTimeout(() => {
                window.location.href = '/dashboard/';
            }, 1000);
        } else {
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
            let errorMsg = '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞';
            
            if (result.data.error) {
                errorMsg = result.data.error;
            } else if (result.data.sport_id && Array.isArray(result.data.sport_id)) {
                errorMsg = result.data.sport_id[0];
            } else if (result.data.specialization_id && Array.isArray(result.data.specialization_id)) {
                errorMsg = result.data.specialization_id[0];
            } else if (result.data.experience_years && Array.isArray(result.data.experience_years)) {
                errorMsg = result.data.experience_years[0];
            } else if (result.data.role && Array.isArray(result.data.role)) {
                errorMsg = result.data.role[0];
            } else if (result.data.city && Array.isArray(result.data.city)) {
                errorMsg = result.data.city[0];
            } else if (result.data.city_coach && Array.isArray(result.data.city_coach)) {
                errorMsg = result.data.city_coach[0];
            } else if (typeof result.data === 'string') {
                errorMsg = result.data;
            } else if (result.data.message) {
                errorMsg = result.data.message;
            }
            
            messagesDiv.innerHTML = `<div class="alert alert-error">–û—à–∏–±–∫–∞: ${errorMsg}</div>`;
        }
    })
    .catch(error => {
        console.error('–û—à–∏–±–∫–∞:', error);
        messagesDiv.innerHTML = '<div class="alert alert-error">–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ä–æ–ª–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É.</div>';
    });
}

function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}
</script>
{% endblock %}
