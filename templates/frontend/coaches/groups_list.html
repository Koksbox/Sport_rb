{% extends 'base.html' %}
{% load static %}

{% block title %}–ú–æ–∏ –≥—Ä—É–ø–ø—ã - –°–ø–æ—Ä—Ç–ë–∞—à{% endblock %}

{% block content %}
<div class="container">
    <div style="margin-bottom: 1rem;">
        <a href="{% url 'frontend-dashboard' %}" style="color: var(--primary-blue); text-decoration: none;">
            ‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç
        </a>
    </div>
    
    <h1>üë• –ú–æ–∏ –≥—Ä—É–ø–ø—ã</h1>
    
    <div id="groupsList">
        <div class="loading" style="margin: 2rem auto; display: block;"></div>
    </div>
</div>

<script>
// –ó–∞–≥—Ä—É–∑–∫–∞ –≥—Ä—É–ø–ø
fetch('/api/coaches/groups/')
    .then(response => response.json())
    .then(groups => {
        const container = document.getElementById('groupsList');
        if (groups && groups.length > 0) {
            // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è–º
            const orgGroups = {};
            groups.forEach(group => {
                const orgName = group.organization_name || '–ë–µ–∑ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏';
                if (!orgGroups[orgName]) {
                    orgGroups[orgName] = [];
                }
                orgGroups[orgName].push(group);
            });
            
            let html = '';
            for (const [orgName, orgGroupsList] of Object.entries(orgGroups)) {
                html += `
                    <div class="card" style="margin-bottom: 2rem;">
                        <div class="card-header">
                            <h2 class="card-title">${escapeHtml(orgName)}</h2>
                        </div>
                        <div class="card-body">
                            <div style="display: flex; flex-direction: column; gap: 1rem;">
                `;
                orgGroupsList.forEach(group => {
                    html += `
                        <div class="card" style="padding: 1rem;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <h4 style="margin-bottom: 0.5rem;">${escapeHtml(group.name || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è')}</h4>
                                    <p style="color: var(--text-light); margin: 0;">
                                        ${escapeHtml(group.sport_name || '')} ‚Ä¢ ${escapeHtml(group.age_level_name || '')}
                                    </p>
                                    <p style="color: var(--text-light); margin: 0;">–°–ø–æ—Ä—Ç—Å–º–µ–Ω–æ–≤: ${group.enrollments ? group.enrollments.length : 0}</p>
                                </div>
                                <a href="/coaches/groups/${group.id}/" class="btn btn-primary">–£–ø—Ä–∞–≤–ª—è—Ç—å</a>
                            </div>
                        </div>
                    `;
                });
                html += `
                            </div>
                        </div>
                    </div>
                `;
            }
            container.innerHTML = html;
        } else {
            container.innerHTML = '<p style="text-align: center; color: var(--text-light);">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –≥—Ä—É–ø–ø</p>';
        }
    })
    .catch(error => {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≥—Ä—É–ø–ø:', error);
        document.getElementById('groupsList').innerHTML = '<p style="color: var(--text-error);">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≥—Ä—É–ø–ø</p>';
    });

function escapeHtml(text) {
    if (!text) return '';
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}
</script>
{% endblock %}
