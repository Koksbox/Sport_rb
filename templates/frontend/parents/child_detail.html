{% extends 'base.html' %}
{% load static %}

{% block title %}–ü—Ä–æ—Ñ–∏–ª—å —Ä–µ–±—ë–Ω–∫–∞ - –°–ø–æ—Ä—Ç–ë–∞—à{% endblock %}

{% block content %}
<div class="container" style="max-width: 1000px;">
    <div style="margin-bottom: 1rem;">
        <a href="{% url 'frontend-parent-children' %}" style="color: var(--primary-blue); text-decoration: none;">
            ‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å–ø–∏—Å–∫—É –¥–µ—Ç–µ–π
        </a>
    </div>
    
    <div id="childProfile">
        <div class="loading" style="margin: 2rem auto; display: block;"></div>
    </div>
</div>

<script>
function loadChildProfile() {
    const childId = {{ child_id }};
    
    fetch(`/api/parents/children/${childId}/`)
        .then(response => {
            if (!response.ok) {
                throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è');
            }
            return response.json();
        })
        .then(data => {
            renderChildProfile(data);
        })
        .catch(error => {
            console.error('–û—à–∏–±–∫–∞:', error);
            document.getElementById('childProfile').innerHTML = 
                '<div class="card"><div class="card-body"><p style="color: var(--error-color);">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è —Ä–µ–±—ë–Ω–∫–∞.</p></div></div>';
        });
}

function renderChildProfile(child) {
    const container = document.getElementById('childProfile');
    
    let html = `
        <h1>üë®‚Äçüë©‚Äçüëß –ü—Ä–æ—Ñ–∏–ª—å —Ä–µ–±—ë–Ω–∫–∞</h1>
        
        <div class="card" style="margin-bottom: 1.5rem;">
            <div class="card-header">
                <h2 class="card-title">–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
            </div>
            <div class="card-body">
                <div class="profile-info">
                    <div class="profile-item">
                        <span class="profile-label">–§–ò–û:</span>
                        <span class="profile-value">${escapeHtml(child.full_name || child.first_name + ' ' + child.last_name)}</span>
                    </div>
                    ${child.birth_date ? `
                    <div class="profile-item">
                        <span class="profile-label">–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è:</span>
                        <span class="profile-value">${escapeHtml(child.birth_date)}</span>
                    </div>
                    ` : ''}
                    ${child.main_sport_name ? `
                    <div class="profile-item">
                        <span class="profile-label">–û—Å–Ω–æ–≤–Ω–æ–π —Å–ø–æ—Ä—Ç:</span>
                        <span class="profile-value">${escapeHtml(child.main_sport_name)}</span>
                    </div>
                    ` : ''}
                    ${child.city_name ? `
                    <div class="profile-item">
                        <span class="profile-label">–ì–æ—Ä–æ–¥:</span>
                        <span class="profile-value">${escapeHtml(child.city_name)}</span>
                    </div>
                    ` : ''}
                    ${child.health_group ? `
                    <div class="profile-item">
                        <span class="profile-label">–ì—Ä—É–ø–ø–∞ –∑–¥–æ—Ä–æ–≤—å—è:</span>
                        <span class="profile-value">${escapeHtml(child.health_group)}</span>
                    </div>
                    ` : ''}
                </div>
            </div>
        </div>
        
        ${child.organization_name && child.organization_name.length > 0 ? `
        <div class="card" style="margin-bottom: 1.5rem;">
            <div class="card-header">
                <h2 class="card-title">–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏</h2>
            </div>
            <div class="card-body">
                <ul>
                    ${child.organization_name.map(org => `<li>${escapeHtml(org)}</li>`).join('')}
                </ul>
            </div>
        </div>
        ` : ''}
        
        ${child.coach_names && child.coach_names.length > 0 ? `
        <div class="card" style="margin-bottom: 1.5rem;">
            <div class="card-header">
                <h2 class="card-title">–¢—Ä–µ–Ω–µ—Ä—ã</h2>
            </div>
            <div class="card-body">
                <ul>
                    ${child.coach_names.map(coach => `<li>${escapeHtml(coach)}</li>`).join('')}
                </ul>
            </div>
        </div>
        ` : ''}
        
        ${child.attendance_stats ? `
        <div class="card" style="margin-bottom: 1.5rem;">
            <div class="card-header">
                <h2 class="card-title">–ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å</h2>
            </div>
            <div class="card-body">
                <div class="profile-info">
                    <div class="profile-item">
                        <span class="profile-label">–í—Å–µ–≥–æ –∑–∞–Ω—è—Ç–∏–π:</span>
                        <span class="profile-value">${child.attendance_stats.total_sessions}</span>
                    </div>
                    <div class="profile-item">
                        <span class="profile-label">–ü–æ—Å–µ—â–µ–Ω–æ:</span>
                        <span class="profile-value">${child.attendance_stats.attended_sessions}</span>
                    </div>
                    <div class="profile-item">
                        <span class="profile-label">–ü—Ä–æ—Ü–µ–Ω—Ç –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏:</span>
                        <span class="profile-value">${child.attendance_stats.attendance_rate}%</span>
                    </div>
                </div>
            </div>
        </div>
        ` : ''}
        
        ${child.events && child.events.length > 0 ? `
        <div class="card" style="margin-bottom: 1.5rem;">
            <div class="card-header">
                <h2 class="card-title">–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</h2>
            </div>
            <div class="card-body">
                <div class="grid grid-2" style="gap: 1rem;">
                    ${child.events.map(event => `
                        <div class="card">
                            <div class="card-body">
                                <h3 style="margin-bottom: 0.5rem;">${escapeHtml(event.title)}</h3>
                                <p style="color: var(--text-light); font-size: 0.9rem;">
                                    ${event.date ? 'üìÖ ' + escapeHtml(event.date) : ''}
                                </p>
                                <p style="color: var(--text-light); font-size: 0.9rem;">
                                    –°—Ç–∞—Ç—É—Å: ${escapeHtml(event.status)}
                                </p>
                            </div>
                        </div>
                    `).join('')}
                </div>
            </div>
        </div>
        ` : ''}
        
        ${child.goals ? `
        <div class="card" style="margin-bottom: 1.5rem;">
            <div class="card-header">
                <h2 class="card-title">–¶–µ–ª–∏</h2>
            </div>
            <div class="card-body">
                <p>${escapeHtml(child.goals)}</p>
            </div>
        </div>
        ` : ''}
    `;
    
    container.innerHTML = html;
}

function escapeHtml(text) {
    if (!text) return '';
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

// –ó–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–æ—Ñ–∏–ª—å –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', function() {
    loadChildProfile();
});
</script>
{% endblock %}
