{% load static %}

<!-- –ü—Ä–æ—Ñ–∏–ª—å —Å–ø–æ—Ä—Ç—Å–º–µ–Ω–∞ -->
{% if user.athlete_profile %}
<div class="role-section">
    <div class="role-section-header">
        <h3>–ü—Ä–æ—Ñ–∏–ª—å —Å–ø–æ—Ä—Ç—Å–º–µ–Ω–∞</h3>
    </div>
    <div class="role-section-content">
        <div class="profile-info">
            {% if user.athlete_profile.city %}
            <div class="profile-item">
                <span class="profile-label">–ì–æ—Ä–æ–¥:</span>
                <span class="profile-value">{{ user.athlete_profile.city.name }}</span>
            </div>
            {% endif %}
            {% if user.athlete_profile.main_sport %}
            <div class="profile-item">
                <span class="profile-label">–û—Å–Ω–æ–≤–Ω–æ–π –≤–∏–¥ —Å–ø–æ—Ä—Ç–∞:</span>
                <span class="profile-value">{{ user.athlete_profile.main_sport.name }}</span>
            </div>
            {% endif %}
            {% if user.athlete_profile.health_group %}
            <div class="profile-item">
                <span class="profile-label">–ì—Ä—É–ø–ø–∞ –∑–¥–æ—Ä–æ–≤—å—è:</span>
                <span class="profile-value">{{ user.athlete_profile.health_group }}</span>
            </div>
            {% endif %}
        </div>
        <div style="margin-top: 1rem;">
            <a href="{% url 'frontend-athlete-profile-edit' %}" class="btn btn-primary" style="width: 100%;">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</a>
        </div>
    </div>
</div>
{% endif %}

<!-- –ú–æ–∏ —Å–µ–∫—Ü–∏–∏ -->
<div class="role-section">
    <div class="role-section-header">
        <h3>–ú–æ–∏ —Å–µ–∫—Ü–∏–∏</h3>
    </div>
    <div class="role-section-content">
        <div id="athleteOrganizations-{{ role_index }}">
            <div class="loading" style="margin: 1rem auto; display: block;"></div>
        </div>
        <div style="margin-top: 1rem;">
            <a href="{% url 'frontend-organizations' %}" class="btn btn-primary" style="width: 100%;">
                üè¢ –ù–∞–π—Ç–∏ —Å–µ–∫—Ü–∏—é
            </a>
        </div>
    </div>
</div>

<!-- –ü—Ä–æ–≥—Ä–µ—Å—Å -->
<div class="role-section">
    <div class="role-section-header">
        <h3>–ú–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å</h3>
    </div>
    <div class="role-section-content">
        <div id="athleteProgress-{{ role_index }}">
            <div class="loading" style="margin: 1rem auto; display: block;"></div>
        </div>
    </div>
</div>

<script>
(function() {
    const roleIndex = {{ role_index|default:0 }};
    
    // –ó–∞–≥—Ä—É–∑–∫–∞ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π —Å–ø–æ—Ä—Ç—Å–º–µ–Ω–∞
    fetch('/api/athletes/organizations/')
    .then(response => response.json())
    .then(data => {
        const container = document.getElementById('athleteOrganizations-' + roleIndex);
        if (data && data.length > 0) {
            let html = '<div style="display: flex; flex-direction: column; gap: 0.75rem;">';
            data.forEach(org => {
                html += `
                    <div style="padding: 0.75rem; background: var(--light-gray); border-radius: 8px;">
                        <h4 style="margin-bottom: 0.25rem; font-size: 1rem;">${escapeHtml(org.name || '')}</h4>
                        <p style="color: var(--text-light); font-size: 0.875rem;">${escapeHtml(org.sport_name || '')}</p>
                    </div>
                `;
            });
            html += '</div>';
            container.innerHTML = html;
        } else {
            container.innerHTML = '<p style="color: var(--text-light); text-align: center; font-size: 0.9rem;">–í—ã –Ω–µ –∑–∞–ø–∏—Å–∞–Ω—ã –≤ —Å–µ–∫—Ü–∏–∏</p>';
        }
    })
    .catch(error => {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π:', error);
        const container = document.getElementById('athleteOrganizations-' + roleIndex);
        if (container) {
            container.innerHTML = '<p style="color: var(--error); text-align: center; font-size: 0.9rem;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</p>';
        }
    });

    // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
    fetch('/api/athletes/progress/')
    .then(response => response.json())
    .then(data => {
        const container = document.getElementById('athleteProgress-' + roleIndex);
        const eventsCount = data.events ? data.events.length : 0;
        const achievementsCount = data.achievements ? data.achievements.length : 0;
        const attendanceCount = data.attendance ? data.attendance.filter(a => a.status === 'present').length : 0;
        
        container.innerHTML = `
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.75rem;">
                <div style="text-align: center; padding: 0.75rem; background: var(--secondary-blue); border-radius: 8px;">
                    <div style="font-size: 1.5rem; font-weight: bold; color: var(--primary-blue);">${eventsCount}</div>
                    <div style="color: var(--text-light); font-size: 0.8rem;">–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π</div>
                </div>
                <div style="text-align: center; padding: 0.75rem; background: var(--secondary-blue); border-radius: 8px;">
                    <div style="font-size: 1.5rem; font-weight: bold; color: var(--primary-blue);">${achievementsCount}</div>
                    <div style="color: var(--text-light); font-size: 0.8rem;">–î–æ—Å—Ç–∏–∂–µ–Ω–∏–π</div>
                </div>
                <div style="text-align: center; padding: 0.75rem; background: var(--secondary-blue); border-radius: 8px;">
                    <div style="font-size: 1.5rem; font-weight: bold; color: var(--primary-blue);">${attendanceCount}</div>
                    <div style="color: var(--text-light); font-size: 0.8rem;">–ü–æ—Å–µ—â–µ–Ω–∏–π</div>
                </div>
            </div>
        `;
    })
    .catch(error => {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞:', error);
        const container = document.getElementById('athleteProgress-' + roleIndex);
        if (container) {
            container.innerHTML = '<p style="color: var(--text-light); text-align: center; font-size: 0.9rem;">–î–∞–Ω–Ω—ã–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã</p>';
        }
    });
})();

function escapeHtml(text) {
    if (!text) return '';
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}
</script>
