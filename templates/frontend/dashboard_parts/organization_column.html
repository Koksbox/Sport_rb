{% load static %}

<!-- –ú–æ–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ -->
<div class="role-section">
    <div class="role-section-header">
        <h3>–ú–æ–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏</h3>
    </div>
    <div class="role-section-content">
        <div id="myOrganizations-{{ role_index }}">
            <div class="loading" style="margin: 1rem auto; display: block;"></div>
        </div>
        <div style="margin-top: 1rem;">
            <a href="{% url 'frontend-organization-create' %}" class="btn btn-primary" style="width: 100%;">
                ‚ûï –°–æ–∑–¥–∞—Ç—å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é
            </a>
            <a href="{% url 'frontend-my-organizations' %}" class="btn btn-secondary" style="width: 100%; margin-top: 0.5rem;">
                üìä –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è–º–∏
            </a>
        </div>
    </div>
</div>

<!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
<div class="role-section">
    <div class="role-section-header">
        <h3>–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h3>
    </div>
    <div class="role-section-content">
        <div style="display: flex; flex-direction: column; gap: 0.5rem;">
            <a href="{% url 'frontend-director-coach-requests' %}" class="btn btn-secondary" style="width: 100%; font-size: 0.875rem; padding: 0.5rem;">
                üìù –ó–∞—è–≤–∫–∏ –Ω–∞ —Ä–∞–±–æ—Ç—É
            </a>
            <a href="{% url 'frontend-director-free-coaches' %}" class="btn btn-secondary" style="width: 100%; font-size: 0.875rem; padding: 0.5rem;">
                üë• –°–≤–æ–±–æ–¥–Ω—ã–µ —Ç—Ä–µ–Ω–µ—Ä—ã
            </a>
        </div>
    </div>
</div>

<script>
(function() {
    const roleIndex = {{ role_index|default:0 }};
    
    // –ó–∞–≥—Ä—É–∑–∫–∞ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π
    fetch('/api/organizations/my/')
    .then(response => response.json())
    .then(data => {
        const container = document.getElementById('myOrganizations-' + roleIndex);
        if (data && data.length > 0) {
            let html = '<div style="display: flex; flex-direction: column; gap: 0.75rem;">';
            data.forEach(org => {
                html += `
                    <div style="padding: 0.75rem; background: var(--light-gray); border-radius: 8px;">
                        <h4 style="margin-bottom: 0.25rem; font-size: 1rem;">${escapeHtml(org.name || '')}</h4>
                        <p style="color: var(--text-light); font-size: 0.875rem;">${escapeHtml(org.city_name || '')}</p>
                    </div>
                `;
            });
            html += '</div>';
            container.innerHTML = html;
        } else {
            container.innerHTML = '<p style="color: var(--text-light); text-align: center; font-size: 0.9rem;">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π</p>';
        }
    })
    .catch(error => {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π:', error);
        const container = document.getElementById('myOrganizations-' + roleIndex);
        if (container) {
            container.innerHTML = '<p style="color: var(--text-light); text-align: center; font-size: 0.9rem;">–î–∞–Ω–Ω—ã–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã</p>';
        }
    });
})();

function escapeHtml(text) {
    if (!text) return '';
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}
</script>
