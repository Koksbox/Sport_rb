# Описание личных кабинетов

## Общая структура

Все личные кабинеты построены по единому принципу:
- **Блок переключения ролей** (если у пользователя несколько ролей)
- **Профиль пользователя** с общими данными
- **Специфичные разделы** для каждой роли
- **Быстрые действия** для основных операций

---

## 1. Кабинет спортсмена

### URL
`/dashboard/` (при активной роли `athlete`)

### Основные разделы

#### 1.1. Мой профиль
- **Общие данные:**
  - ФИО (синхронизируется со всеми ролями)
  - Фото (синхронизируется)
  - Email
  - Дата рождения (опционально)
  - Пол (опционально)
  - Город (синхронизируется)

- **Спортивные данные:**
  - Основной вид спорта
  - Дополнительные виды спорта
  - Группа здоровья (I, II, III)
  - Цели (Соревнования, ЗОЖ, Разряд и т.д.)

- **Медицинские данные:**
  - Проблемы со здоровьем (чекбоксы)
  - Описание проблем со здоровьем
  - Аллергии
  - Экстренный контакт

- **Уникальный ID спортсмена:**
  - Отображается для связи с родителями
  - Кнопка копирования ID

#### 1.2. Быстрые действия
- **Редактировать общие данные** → `/users/basic-data/edit/`
- **Редактировать профиль спортсмена** → `/athletes/profile/edit/`
- **Найти организацию** → `/organizations/`
- **Мероприятия** → `/events/`

#### 1.3. Статистика и прогресс
- **График посещаемости:**
  - Процент посещаемости тренировок
  - График по месяцам
  - Статистика по группам

- **Участие в соревнованиях:**
  - Количество участий
  - Предстоящие мероприятия
  - История участия

- **Достижения:**
  - Разряды
  - Награды
  - Результаты ГТО

#### 1.4. Мои организации
- Список организаций, в которых состоит спортсмен
- Группы, в которых занимается
- Тренеры

#### 1.5. Запросы от родителей
- Список запросов на связь от родителей
- Возможность подтвердить или отклонить

### Функциональность

**Редактирование профиля:**
- Обновление общих данных (ФИО, фото, город) синхронизируется со всеми ролями
- Обновление спортивных данных влияет только на роль спортсмена
- Медицинские данные зашифрованы (AES-256)

**Подача заявок:**
- Заявка в конкретную группу → директор назначает в группу
- Заявка на секцию → директор решает, в какую группу определить

**Просмотр статистики:**
- Посещаемость по группам
- Участие в мероприятиях
- Достижения и разряды

---

## 2. Кабинет тренера

### URL
`/dashboard/` (при активной роли `coach`)

### Основные разделы

#### 2.1. Мой профиль
- **Общие данные:** (синхронизируются)
  - ФИО, фото, город, email

- **Профессиональные данные:**
  - Специализация (вид спорта)
  - Опыт работы (лет)
  - Образование
  - Биография
  - Контакты (телефон, Telegram)

#### 2.2. Быстрые действия
- **Редактировать общие данные** → `/users/basic-data/edit/`
- **Редактировать профиль тренера** → `/coaches/profile/edit/`
- **Мои группы** → `/coaches/groups/`
- **Найти организацию** → `/coaches/organizations/find/`
- **Приглашения** → `/coaches/invitations/`
- **Мероприятия** → `/events/`

#### 2.3. Мои организации
- Список организаций, в которых работает тренер
- Статус работы (активен/неактивен)
- Ссылки на группы в каждой организации

#### 2.4. Мои группы
- Список всех групп тренера
- Количество спортсменов в каждой группе
- Быстрый доступ к детальной информации о группе

#### 2.5. Детальная информация о группе
- **Информация о группе:**
  - Название, вид спорта, возрастной уровень
  - Расписание тренировок
  - Описание

- **Список спортсменов:**
  - ФИО, возраст
  - Статус посещаемости на выбранную дату
  - Кнопки для отметки посещаемости

- **Отметка посещаемости:**
  - Выбор даты
  - Кнопки "Присутствовал", "Отсутствовал", "Опоздал"
  - Указание причины отсутствия (при необходимости)

- **Статистика посещаемости:**
  - Общий процент посещаемости группы
  - Статистика по каждому спортсмену
  - График посещаемости

#### 2.6. Заявки спортсменов
- Список заявок на вступление в группы
- Возможность одобрить или отклонить
- Просмотр сообщения от спортсмена

### Функциональность

**Трудоустройство:**
- Просмотр свободных организаций
- Подача заявки на работу
- Просмотр приглашений от директоров
- Принятие/отклонение приглашений

**Управление группами:**
- Просмотр всех своих групп
- Отметка посещаемости
- Просмотр статистики
- Одобрение заявок спортсменов

**Регистрация на мероприятия:**
- Просмотр доступных мероприятий
- Регистрация отдельных спортсменов
- Регистрация целых групп
- Ограничение: только свои группы/спортсмены

---

## 3. Кабинет директора организации

### URL
`/dashboard/` (при активной роли `director` или `organization`)

### Основные разделы

#### 3.1. Мой профиль
- **Общие данные:** (синхронизируются)
  - ФИО, фото, город, email

#### 3.2. Быстрые действия
- **Редактировать общие данные** → `/users/basic-data/edit/`
- **Мои организации** → `/organizations/my/`
- **Создать организацию** → `/organizations/create/`
- **Заявки на работу** → `/director/coach-requests/`
- **Свободные тренеры** → `/director/free-coaches/`
- **Мероприятия** → `/events/`

#### 3.3. Мои организации
- Список всех созданных организаций
- Статус модерации
- Быстрый доступ к управлению

#### 3.4. Управление организацией
- **Основная информация:**
  - Название, тип, адрес, ИНН
  - Статус модерации
  - Координаты на карте

- **Секции (SportDirection):**
  - Список видов спорта в организации
  - Добавление новых секций

- **Группы:**
  - Список всех групп организации
  - Создание новых групп
  - Настройка расписания
  - Назначение тренеров

- **Тренеры:**
  - Список работающих тренеров
  - Управление тренерами

#### 3.5. Заявки на работу от тренеров
- Список всех заявок
- Информация о тренере (специализация, опыт)
- Сообщение от тренера
- Одобрение/отклонение заявок

#### 3.6. Свободные тренеры
- Поиск тренеров по городу и специализации
- Просмотр профилей тренеров
- Отправка приглашений на работу
- Указание условий работы

#### 3.7. Заявки спортсменов
- Заявки на вступление в группы
- Заявки на вступление в секции
- Одобрение/отклонение заявок
- Назначение спортсменов в группы

#### 3.8. Регистрация на мероприятия
- Просмотр доступных мероприятий
- Регистрация любых спортсменов организации
- Регистрация любых групп организации
- Ограничение: только спортсмены своей организации

### Функциональность

**Создание организации:**
- Заполнение формы с автозаполнением данных
- Выбор города на карте (Яндекс.Карты)
- Загрузка документов (необязательно)
- Отправка на модерацию

**Управление организацией:**
- Добавление секций (видов спорта)
- Создание групп
- Настройка расписания
- Управление тренерами

**Работа с тренерами:**
- Просмотр заявок от тренеров
- Поиск свободных тренеров
- Отправка приглашений
- Управление составом тренеров

---

## 4. Кабинет родителя

### URL
`/dashboard/` (при активной роли `parent`)

### Основные разделы

#### 4.1. Мой профиль
- **Общие данные:** (синхронизируются)
  - ФИО, фото, город, email

#### 4.2. Быстрые действия
- **Редактировать общие данные** → `/users/basic-data/edit/`
- **Редактировать профиль родителя** → `/parents/profile/edit/`
- **Мои дети** → `/parents/children/`
- **Заявки** → `/parents/requests/`

#### 4.3. Мои дети
- Список всех связанных детей
- Базовая информация о каждом ребёнке
- Быстрый доступ к детальному профилю

#### 4.4. Добавление ребёнка
- Модальное окно для ввода уникального ID ребёнка
- Отправка запроса на связь
- Ожидание подтверждения от ребёнка

#### 4.5. Профиль ребёнка
- **Основная информация:**
  - ФИО, фото, возраст
  - Основной вид спорта
  - Организация и группа

- **Статистика посещаемости:**
  - Общий процент посещаемости
  - Количество посещённых тренировок
  - График посещаемости

- **Участие в мероприятиях:**
  - Количество участий
  - Предстоящие мероприятия
  - История участия

- **Достижения:**
  - Разряды
  - Награды
  - Результаты ГТО

#### 4.6. Заявки на связь
- Запросы, отправленные родителем (ожидают подтверждения ребёнком)
- Запросы, отправленные ребёнком (ожидают подтверждения родителем)
- Возможность подтвердить или отклонить

### Функциональность

**Связь с ребёнком:**
- Получение уникального ID ребёнка
- Отправка запроса на связь
- Подтверждение запроса ребёнком
- Автоматическое создание роли "Родитель" при добавлении первого ребёнка

**Мониторинг:**
- Просмотр всех данных ребёнка
- Отслеживание посещаемости
- Просмотр достижений
- Получение уведомлений о важных событиях

**Управление несколькими детьми:**
- Добавление неограниченного количества детей
- Переключение между профилями
- Сравнение статистики

---

## 5. Кабинет главного администратора (Админ РБ)

### URL
`/admin-dashboard/`

### Доступ
- Роль `admin_rb`
- Или `is_superuser = True`

### Основные разделы

#### 5.1. Общая статистика
- **Пользователи:**
  - Всего пользователей
  - Активных пользователей
  - По ролям

- **Организации:**
  - Всего организаций
  - На модерации
  - Одобренных
  - Отклонённых

- **Мероприятия:**
  - Всего мероприятий
  - Опубликованных
  - Завершённых

- **Посещаемость:**
  - Всего записей о посещаемости
  - Средний процент посещаемости

#### 5.2. Управление пользователями
- **Список пользователей:**
  - Поиск по email/имени
  - Фильтр по ролям
  - Фильтр по статусу активности
  - Пагинация

- **Действия:**
  - Активировать/деактивировать пользователя
  - Назначить роль (модератор, админ РБ)
  - Просмотр детальной информации

#### 5.3. Управление организациями
- **Список организаций:**
  - Поиск по названию/ИНН
  - Фильтр по статусу
  - Фильтр по типу
  - Пагинация

- **Действия:**
  - Одобрить/отклонить организацию
  - Просмотр документов
  - Редактирование (при необходимости)

#### 5.4. Модерация организаций
- **Организации на модерации:**
  - Список ожидающих модерации
  - Просмотр всех данных
  - Просмотр загруженных документов
  - Одобрение/отклонение с комментарием

#### 5.5. Логи системы
- **Аудит логи:**
  - Все действия пользователей
  - Фильтр по пользователю
  - Фильтр по действию
  - Фильтр по дате

- **Django логи:**
  - Ошибки приложения
  - Предупреждения
  - Информационные сообщения

#### 5.6. Назначение ролей
- Выбор пользователя
- Выбор роли (модератор, админ РБ)
- Подтверждение назначения

### Функциональность

**Модерация:**
- Просмотр всех данных организации
- Проверка документов
- Одобрение/отклонение с комментарием
- Уведомление директора о решении

**Управление пользователями:**
- Активация/деактивация аккаунтов
- Назначение системных ролей
- Мониторинг активности

**Мониторинг системы:**
- Просмотр статистики
- Анализ логов
- Выявление проблем

---

## 6. Общие элементы всех кабинетов

### 6.1. Блок переключения ролей
Отображается, если у пользователя более одной роли:
- Кнопки для каждой роли
- Активная роль выделена
- Кнопка "Добавить роль" (если ролей меньше 4)
- Переключение через API `/api/users/switch-role/`

### 6.2. Редактирование общих данных
Доступно из всех кабинетов:
- ФИО (одно поле с валидацией)
- Фото (опционально)
- Дата рождения (опционально)
- Пол (опционально)
- Город (автокомплит с картой)

**URL:** `/users/basic-data/edit/`

### 6.3. Навигация
- Личный кабинет
- Мероприятия
- Организации
- Выход

### 6.4. Уведомления
- Иконка уведомлений в навигации
- Список непрочитанных уведомлений
- Отметка как прочитанное

---

## 7. Переключение между кабинетами

### Механизм переключения

1. **Пользователь нажимает на роль** в блоке переключения
2. **Отправляется запрос** на `/api/users/switch-role/`
3. **Активная роль сохраняется** в сессии
4. **Происходит редирект** на `/dashboard/`
5. **Отображается кабинет** соответствующей роли

### Сохранение данных
- Общие данные (ФИО, фото, город) синхронизируются автоматически
- Специфичные данные каждой роли сохраняются отдельно
- При переключении роли загружаются соответствующие данные

---

## 8. Особенности реализации

### Синхронизация данных
- Обновление общих данных в одном кабинете отражается во всех
- Используется единая модель `CustomUser`
- Специфичные данные хранятся в профилях ролей

### Безопасность
- Доступ к кабинету только для авторизованных пользователей
- Проверка наличия роли перед отображением кабинета
- Разделение прав доступа для разных ролей

### Производительность
- Ленивая загрузка данных
- Кэширование часто используемых данных
- Оптимизация запросов к базе данных
